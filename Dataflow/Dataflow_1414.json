{"dataflow":{"dfKey":"3158c743-b833-4223-b2d2-f913e3ecfc67","name":"Dataflow_1414","tags":null,"description":null,"definition":"{\"name\":\"Dataflow_1414\",\"engineVariableName\":\"\",\"components\":[{\"udfNames\":[],\"componentId\":0,\"componentName\":\"startComponent\",\"tableName\":\"\",\"category\":\"Start\",\"componentType\":\"UDF\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":0,\"dependencies\":[],\"className\":\"com.datagaps.dataflow.models.UDFComponent\",\"executionOption\":\"\",\"excludeNotification\":\"Y\"},{\"code\":\"import traceback\\r\\nimport sys\\r\\nimport json\\r\\n\\r\\nminio_access_key \\u003d spark.sparkContext._jvm.com.datagaps.core.engine.utils.CodeUtils.getPasswordByKeyAndContainerIdFromWallet(\\\"minio_access_key\\\", 715)\\r\\nminio_secret_key \\u003d spark.sparkContext._jvm.com.datagaps.core.engine.utils.CodeUtils.getPasswordByKeyAndContainerIdFromWallet(\\\"minio_secret_key\\\", 715)\\r\\nminio_endpoint \\u003d \\\"http://192.168.6.91:9000\\\"\\r\\nminio_warehouse \\u003d f\\\"s3a://iceberg-warehouse/\\\"\\r\\niceberg_table_path \\u003d \\\"my_catalog.default.customers\\\"\\r\\noutput_dataset \\u003d \\\"Customer_iceberg\\\"\\r\\n\\r\\ndef configure_spark_for_minio():\\r\\n    spark.conf.set(\\\"spark.sql.catalog.my_catalog\\\", \\\"org.apache.iceberg.spark.SparkCatalog\\\")\\r\\n    spark.conf.set(\\\"spark.sql.catalog.my_catalog.catalog-impl\\\", \\\"org.apache.iceberg.hadoop.HadoopCatalog\\\")\\r\\n    spark.conf.set(\\\"spark.sql.catalog.my_catalog.warehouse\\\", minio_warehouse)\\r\\n    spark.conf.set(\\\"spark.sql.catalog.my_catalog.hadoop.fs.s3a.endpoint\\\", minio_endpoint)\\r\\n    spark.conf.set(\\\"spark.sql.catalog.my_catalog.hadoop.fs.s3a.access.key\\\", minio_access_key)\\r\\n    spark.conf.set(\\\"spark.sql.catalog.my_catalog.hadoop.fs.s3a.secret.key\\\", minio_secret_key)\\r\\n    spark.conf.set(\\\"spark.sql.catalog.my_catalog.hadoop.fs.s3a.path.style.access\\\", \\\"true\\\")\\r\\n    spark.conf.set(\\\"spark.sql.catalog.my_catalog.hadoop.fs.s3a.connection.ssl.enabled\\\", \\\"false\\\")\\r\\n    spark.conf.set(\\\"spark.sql.catalog.my_catalog.hadoop.fs.s3a.impl\\\", \\\"org.apache.hadoop.fs.s3a.S3AFileSystem\\\")\\r\\n\\r\\ndef read_iceberg_table(table_path):\\r\\n    try:\\r\\n        df \\u003d spark.read.table(table_path)\\r\\n        df.createOrReplaceTempView(output_dataset)\\r\\n        print(output_dataset)\\r\\n        df.show(25)\\r\\n \\r\\n        spark.sparkContext._jvm.com.datagaps.core.engine.utils.CodeUtils.saveDataset(\\r\\n        df._jdf, output_dataset, \\u0027Iceberg_tables_in_S3\\u0027, 19492)\\r\\n        \\r\\n        print(f\\\"Successfully read Iceberg table: {table_path}\\\")\\r\\n    except Exception:\\r\\n        print(f\\\"Error reading Iceberg table: {table_path}\\\")\\r\\n        # traceback.print_exc()\\r\\n        \\r\\n        \\r\\ndef main():\\r\\n    configure_spark_for_minio()\\r\\n    read_iceberg_table(iceberg_table_path)\\r\\n    \\r\\nmain()\\r\\n\",\"kind\":\"pyspark\",\"dataSourceId\":0,\"hideDatasets\":\"N\",\"componentId\":1,\"componentName\":\"Customer_Iceberg\",\"tableName\":\"Customer_Iceberg\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"executionOption\":\"\",\"excludeNotification\":\"N\"},{\"partitionOptions\":{\"partitionType\":\"\",\"name\":\"\"},\"easyQueryDefJson\":{\"sqlQuery\":\"\"},\"componentId\":2,\"componentName\":\"SQL 2\",\"tableName\":\"SQL_2\",\"category\":\"Processor\",\"componentType\":\"SQL\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[1],\"options\":{\"dbTable\":\"select * from Customer_Iceberg\"},\"className\":\"com.datagaps.dataflow.models.SQLComponent\",\"isCheckpointEnabled\":\"N\",\"executionOption\":\"allparentpassorfail\",\"excludeNotification\":\"N\"}],\"isDeleteWorkSchemaTable\":\"N\"}","parameters":"[{\"type\":\"static\",\"name\":\"limit_rows\",\"defValueInInteractiveMode\":\"limit 10\",\"defValueInBatchMode\":\"limit 1000\"}]","version":3,"maxComponentId":2,"livyOptions":null,"isDeleted":"N","userName":null,"type":"dataflow","environmentName":"","folderPath":"Dataflow","workSchemaName":null,"diagramSchema":"{\"isCustom\":false,\"diagramDef\":[]}"},"analysis":[],"datamodels":[],"tagDetails":[],"dataCompares":[],"filterDatasetMappings":[],"referenceDatasets":null}